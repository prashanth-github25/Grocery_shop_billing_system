{% extends "base.html" %}
{% block content %}
<div class="row g-4">
  <div class="col-lg-5">
    <div class="p-4 bg-white rounded shadow-sm">
      <h4 class="mb-3">Add Item to Cart</h4>
      <form method="post" action="/cart/add">
        <div class="mb-3">
          <label class="form-label">Product</label>
          <select class="form-select" name="product_name" required>
            {% for p in products %}
              <option value="{{ p.name }}">{{ p.name }} — ₹{{ "%.2f"|format(p.price) }} (Stock: {{ "%.2f"|format(p.stock) }})</option>
            {% else %}
              <option disabled>No products available</option>
            {% endfor %}
          </select>
        </div>
        <div class="mb-3">
          <label class="form-label">Quantity</label>
          <input type="number" step="0.01" min="0.01" name="quantity" class="form-control" required>
        </div>
        <button type="submit" class="btn btn-success">Add to Cart</button>
      </form>

      <hr>

      <h4 class="mb-3">Apply Discount</h4>
      <form method="post" action="/discount/apply" class="d-flex gap-2">
        <input type="number" step="0.01" min="0" max="100" name="percent" class="form-control" placeholder="e.g., 5" required>
        <button type="submit" class="btn btn-outline-primary">Apply</button>
      </form>
      <div class="form-text">Discount applies to the current subtotal.</div>
    </div>
  </div>

  <div class="col-lg-7">
    <div class="p-4 bg-white rounded shadow-sm">
      <h4 class="mb-3">Cart</h4>
      <div class="table-responsive">
        <table class="table table-sm align-middle">
          <thead>
            <tr>
              <th>Product</th>
              <th>Qty</th>
              <th>Price (₹)</th>
              <th>Cost (₹)</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            {% for it in cart_items %}
            <tr>
              <td>{{ it.name }}</td>
              <td>{{ "%.2f"|format(it.qty) }}</td>
              <td>{{ "%.2f"|format(it.price) }}</td>
              <td>{{ "%.2f"|format(it.price * it.qty) }}</td>
              <td>
                <!-- Remove item -->
                <form method="post" action="/cart/remove" onsubmit="return confirm('Remove this item from cart?');">
                  <input type="hidden" name="product_name" value="{{ it.name }}">
                  <button class="btn btn-sm btn-outline-danger">Remove</button>
                </form>
              </td>
            </tr>
            {% else %}
            <tr><td colspan="5" class="text-muted">Cart is empty.</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <div class="mt-3">
        <p class="mb-1"><strong>Subtotal:</strong> ₹{{ "%.2f"|format(totals.subtotal) }}</p>
        <p class="mb-1"><strong>Discount:</strong> {{ "%.2f"|format(totals.discount_percent) }}% (₹{{ "%.2f"|format(totals.discount_amount) }})</p>
        <p class="fs-5"><strong>Final Total:</strong> ₹{{ "%.2f"|format(totals.final_total) }}</p>
      </div>

      <form method="post" action="/checkout" onsubmit="return confirm('Proceed to checkout? This will clear the cart.');">
        <button class="btn btn-primary">Checkout</button>
        <a href="/inventory" class="btn btn-outline-secondary ms-2">Back to Inventory</a>
      </form>
    </div>
  </div>
</div>
{% endblock %}
